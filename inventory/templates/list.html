<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <title>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'styles.css' %}">
    <script src="{% static 'script.js' %}"></script>
</head>
<body>

<div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
        <a href="{% url 'my_view' %}" class="item-card"><i class="bi bi-bar-chart-line"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</a>
        <a href="{% url 'order_view' %}" class="item-card"><i class="bi bi-clipboard-data"></i> ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</a>
        <a href="{% url 'graph_view' %}" class="item-card"><i class="bi bi-pie-chart"></i> ‡∏Å‡∏£‡∏≤‡∏ü</a>
        <a href="{% url 'products' %}" class="item-card"><i class="bi bi-box-seam"></i> ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
        <a href="{% url 'stock_view' %}" class="item-card"><i class="bi bi-box-seam"></i> ‡∏™‡∏ï‡πä‡∏≠‡∏Å</a>
        <a href="{% url 'home1' %}" class="home-icon"><i class="bi bi-house"></i></a>
    </aside>

    <!-- Main Content -->
    <main class="content">
        <h1>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>

        <!-- Search & Filter Section -->
        <div class="filter-section">
            <form method="GET">
                <input type="text" name="q" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." value="{{ query }}">

                <!-- Dropdown: ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà -->
                <select name="category">
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà --</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}" {% if category.id|stringformat:"s" == selected_category %}selected{% endif %}>
                            {{ category.name }}
                        </option>
                    {% endfor %}
                </select>

                <!-- Dropdown: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
                <select name="status">
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ --</option>
                    <option value="available" {% if selected_status == 'available' %}selected{% endif %}>Available</option>
                    <option value="out_of_stock" {% if selected_status == 'out_of_stock' %}selected{% endif %}>Out of Stock</option>
                    <option value="discontinued" {% if selected_status == 'discontinued' %}selected{% endif %}>Discontinued</option>
                </select>

                <button type="submit" class="btn">üîé ‡∏Å‡∏£‡∏≠‡∏á</button>
                <a href="{% url 'my_view' %}" class="btn reset-btn">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</a>
            </form>
        </div>


        <!-- Products Table -->
        <table class="table">
            <thead>
            <tr>
                <th>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                <th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ô‡∏™‡∏ï‡πä‡∏≠‡∏Å</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
            </thead>
            <tbody>
            {% if products %}
            {% for product in products %}
            <tr>
                <td>{{ product.product_code }}</td>
                <td>{{ product.product_name }}</td>
                <td>{{ product.category.name|default:"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏" }}</td>
                <td>{{ product.price|floatformat:2 }}</td>
                <td class="stock-count" data-stock="{{ product.total_stock|default:'0' }}">{{ product.total_stock|default:"0" }}</td>
                <td class="product-status"></td>

                <td>
                    <a href="{% url 'product_detail_view' product.id %}" class="btn btn-primary">üìÑ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</a>
                    {% if user.is_authenticated and user.is_staff %}
                    <a href="{% url 'edit_product' product.id %}" class="btn btn-warning">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
            {% else %}
            <tr>
                <td colspan="7" style="text-align: center;">‚õî ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</td>
            </tr>
            {% endif %}
            </tbody>
        </table>
    </main>
</div>
<script>
document.addEventListener("DOMContentLoaded", function () {
    let rows = document.querySelectorAll(".stock-count");

    rows.forEach(row => {
        let stock = parseInt(row.getAttribute("data-stock"), 10);
        let statusCell = row.nextElementSibling; // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å `<td>` ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        let statusText = "";
        let statusColor = "";

        if (stock > 5) {
            statusText = "‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏≤‡∏¢";
            statusColor = "green";
        } else if (stock > 0) {
            statusText = "‚ö†Ô∏è ‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î";
            statusColor = "orange";
        } else {
            statusText = "‚ùå ‡∏´‡∏°‡∏î‡∏™‡∏ï‡πä‡∏≠‡∏Å";
            statusColor = "red";
        }

        statusCell.textContent = statusText;
        statusCell.style.color = statusColor;
    });
});
</script>
</body>
</html>


